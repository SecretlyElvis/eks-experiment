* Code Repo:
https://github.com/SecretlyElvis/eks-experiment.git

### AWS | resources

ALB Ingress Controller for EKS:
https://docs.aws.amazon.com/eks/latest/userguide/alb-ingress.html

Annotations for ALB Ingress controller:
kubernetes.io/ingress.class: alb
alb.ingress.kubernetes.io/group.name: <my-group> (to add multiple ingress elements to single group)
alb.ingress.kubernetes.io/group.order: <'10'> (to order rules, lower numbers evaluated first)

When defining the load balancer, specify 'Instance' traffic mode (routes to node, then proxies to pods) 
alb.ingress.kubernetes.io/target-type: instance

Ingress Annotation list:
https://kubernetes-sigs.github.io/aws-load-balancer-controller/guide/ingress/annotations/

Ingress IAM policy (downloaded and installed for ALB):
https://raw.githubusercontent.com/kubernetes-sigs/aws-load-balancer-controller/v2_ga/docs/install/iam_policy.json

### HELM | Jenkins

Official Jenkins.io Installing Jenkins on Kubernetes:
https://www.jenkins.io/doc/book/installing/kubernetes/

Jenkins on Kubernetes Engine:
https://cloud.google.com/solutions/jenkins-on-kubernetes-engine

Helm Chart codebase:
https://github.com/jenkinsci/helm-charts

https://bitnami.com/stack/jenkins/helm
https://medium.com/faun/deploying-and-scaling-jenkins-on-kubernetes-2cd4164720bd
https://medium.com/appfleet/how-to-set-up-jenkins-on-kubernetes-70f8eac3dc7e
https://hands-on-tech.github.io/2020/03/15/k8s-jenkins-example.html
https://cloud.google.com/solutions/jenkins-on-kubernetes-engine?hl=it
https://www.edureka.co/community/74612/how-to-configure-jenkins-environment-using-helm
https://docs.netapp.com/us-en/project-astra/pdfs/pages/solutions/jenkins-deploy-from-helm-chart.pdf

https://cloudacademy.com/course/introduction-to-helm-1034/helm-charts/

Useful commands:
helm search repo jenkinsci

### HELM | Nexus

https://blog.sonatype.com/how-to-use-nexus-repository-and-helm-for-ci/cd
https://help.sonatype.com/repomanager3/formats/helm-repositories
https://github.com/helm/charts/tree/master/stable/sonatype-nexus (deprecated)
https://stackoverflow.com/questions/52274286/run-nexus-in-kubernetes-cluster-using-helm
https://www.freshbrewed.science/getting-started-with-containerized-nexus/index.html
https://www.sonatype.com/press-release-blog/sonatype-adds-native-helm-support

Possible chart option (Otemo -- GCP-specific):
https://github.com/Oteemo/charts

Kubernetes Nexus:
https://github.com/travelaudience/kubernetes-nexus#pre-requisites

Backing up Nexus Configs and Artifacts:
https://blog.sonatype.com/2010/01/how-to-backup-nexus-configuration-and-repository-artifacts/

Why use Nexus?:
https://blog.sonatype.com/how-to-use-nexus-repository-and-helm-for-ci/cd

Very basic Nexus setup:
https://devopscube.com/setup-nexus-kubernetes/

Official Nexus Repository Docker Image:
https://hub.docker.com/r/sonatype/nexus3

TravelAudience Nexus Repository Docker Image:
https://quay.io/repository/travelaudience/docker-nexus

#### RESOURCES ####

-- Ingress Controllers 101 (HAProxy):
https://thenewstack.io/kubernetes-ingress-for-beginners/

-- Using the HAProxy Ingress controller (good exapmles at the bottom):
https://www.haproxy.com/documentation/hapee/1-5r2/installation/kubernetes-ingress-controller/
https://www.ionos.com/community/markdown-migration/configure-and-manage-a-kubernetes-haproxy-ingress-controller/

-- Installing HAProxy Ingress Controller into EKS:
https://www.haproxy.com/documentation/kubernetes/latest/installation/community/aws/

Troubleshooting:
kubectl logs <pod>

Install with debug logs:
helm install haproxy haproxytech/kubernetes-ingress \
  --set controller.logging.level=debug

View source YAML:
kubectl get deployment <deployment> -o yaml

-- Troubleshooting HAProxy Ingresss Controller:
https://www.haproxy.com/documentation/kubernetes/latest/usage/troubleshooting/

Getitng logs from elements in Kubernetes:
kubectl logs -n kube-system   deployment.apps/aws-load-balancer-controller

-- ClusterRole with multiple ApiGroups:

kind: Role
apiVersion: rbac.authorization.k8s.io/v1
metadata:
 name: get-pods
rules:
 - apiGroups: ["*"]
   resources: ["pods"]
   verbs: ["list","get","watch"]
 - apiGroups: ["extensions","apps"]
   resources: ["deployments"]
   verbs: ["get","list","watch","create","update","patch","delete"]

-- Mounting EFS file system:
sudo mount -t nfs -o nfsvers=4.1,rsize=1048576,wsize=1048576,hard,timeo=600,retrans=2,noresvport fs-5c588564.efs.ap-southeast-2.amazonaws.com:/ efs

-- Mounting EFS Access Point:
mount -t efs -o tls,accesspoint=fsap-12345678 fs-12345678: /localmountpoint

-- Install EFS CSI driver into Kubernetes (for accessing PersistentVolumes with CSI driver instead of NFS)
kubectl apply -k "github.com/kubernetes-sigs/aws-efs-csi-driver/deploy/kubernetes/overlays/stable/ecr/?ref=release-1.0"

-- Mounting EFS subdirectory as PV using CSI driver:
https://github.com/kubernetes-sigs/aws-efs-csi-driver/blob/master/examples/kubernetes/volume_path/README.md 

* Learn EKS standup with Terraform:
https://learn.hashicorp.com/tutorials/terraform/eks

If you're running the AWS CLI version 1.16.156 or later, then you don't need to install the authenticator. Instead, you can use the aws eks get-token command. For more information, see Create kubeconfig manually. 

* Install EFS CSI driver to EKS cluster (so EFS can be mounted)
https://docs.aws.amazon.com/eks/latest/userguide/efs-csi.html

* Attach EFS to EKS with Terraform:
https://stackoverflow.com/questions/60609820/how-to-use-amazon-efs-with-eks-in-terraform
